---
phase: 03-trace-analysis-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/pages/TestMonitor/TraceAnalysisPage.tsx
  - frontend/src/services/api/testMonitorApi.ts
  - frontend/src/routes/AppRouter.tsx
  - frontend/src/pages/TestMonitor/index.tsx
autonomous: true

must_haves:
  truths:
    - "Trace Analysis page is accessible from TestMonitor navigation tabs"
    - "User can enter a session ID and see trace tree with timestamps"
    - "User can see extracted transcript for any loaded trace"
    - "User can see intent classification (type, confidence, summary) when available"
    - "Deep linking via ?sessionId=xxx auto-loads the trace"
  artifacts:
    - path: "frontend/src/pages/TestMonitor/TraceAnalysisPage.tsx"
      provides: "Main trace analysis page component"
      min_lines: 200
    - path: "frontend/src/services/api/testMonitorApi.ts"
      provides: "getTraceAnalysis API function"
      contains: "getTraceAnalysis"
    - path: "frontend/src/routes/AppRouter.tsx"
      provides: "Route registration for trace-analysis"
      contains: "trace-analysis"
  key_links:
    - from: "frontend/src/pages/TestMonitor/TraceAnalysisPage.tsx"
      to: "/api/trace-analysis/:sessionId"
      via: "getTraceAnalysis function call"
      pattern: "getTraceAnalysis"
    - from: "frontend/src/routes/AppRouter.tsx"
      to: "TraceAnalysisPage"
      via: "Route element"
      pattern: "TraceAnalysisPage"
    - from: "frontend/src/pages/TestMonitor/index.tsx"
      to: "trace-analysis"
      via: "tab entry"
      pattern: "trace-analysis"
---

<objective>
Create the Trace Analysis page with session search, trace tree display, transcript viewer, and intent classification card. Wire into routing and navigation.

Purpose: Deliver the core interactive investigation UI (requirements UI-01, UI-02 partially).
Output: A new page accessible at /test-monitor/trace-analysis that loads and displays trace data.
</objective>

<execution_context>
@C:\Users\mwoic\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\mwoic\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-trace-analysis-ui/03-RESEARCH.md
@frontend/src/pages/TestMonitor/CallTracePage.tsx
@frontend/src/pages/TestMonitor/index.tsx
@frontend/src/routes/AppRouter.tsx
@frontend/src/services/api/testMonitorApi.ts
@backend/src/controllers/traceAnalysisController.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add API client function and TypeScript types</name>
  <files>frontend/src/services/api/testMonitorApi.ts</files>
  <action>
Add a `TraceAnalysisResponse` interface matching the backend response shape (see 03-RESEARCH.md "Backend API Response Shape" section). Include nested types for intent, toolSequence, verification, and transcript turns.

Add `getTraceAnalysis(sessionId: string, options?: { verify?: boolean; force?: boolean; configId?: number }): Promise<TraceAnalysisResponse>` function following the existing `get` helper pattern in testMonitorApi.ts. Build query string from options, call `get<TestMonitorApiResponse<TraceAnalysisResponse>>(/trace-analysis/${sessionId}${qs})`, return `.data`.

Do NOT create a separate types file -- put interfaces directly in testMonitorApi.ts alongside the existing types (matches codebase pattern where types are co-located with API functions).
  </action>
  <verify>TypeScript compilation passes: `cd frontend && npx tsc --noEmit 2>&1 | head -20`</verify>
  <done>TraceAnalysisResponse type and getTraceAnalysis function exist in testMonitorApi.ts, compile without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create TraceAnalysisPage component with routing and nav</name>
  <files>
    frontend/src/pages/TestMonitor/TraceAnalysisPage.tsx
    frontend/src/routes/AppRouter.tsx
    frontend/src/pages/TestMonitor/index.tsx
  </files>
  <action>
Create `TraceAnalysisPage.tsx` as a functional component following CallTracePage patterns:

1. **State:** sessionId input, loading, error, result (TraceAnalysisResponse | null)
2. **Deep linking:** useSearchParams to read ?sessionId param on mount, clear after reading (setSearchParams({}, { replace: true }))
3. **Search bar:** Input + "Analyze" button at top. On submit, call getTraceAnalysis(sessionId) with loading/error handling.
4. **Section 1 - Trace List:** Card showing traces array as a simple list with traceId, timestamp, name. Show count badge.
5. **Section 2 - Intent Classification:** Card with type badge (colored by type: booking=green, inquiry=blue, cancellation=red, other=gray), confidence percentage, summary text. Show "Not available - run analysis" if intent is null.
6. **Section 3 - Transcript:** Card with conversation turns rendered as alternating user/assistant bubbles (simple div styling with bg-blue-50 for user, bg-gray-50 for assistant). Check if TranscriptViewer component exists in `components/features/testMonitor/` and reuse if available; otherwise render inline.
7. **Section 4 - Tool Sequence:** Card showing steps array as numbered list with tool name and status badge (green check for success, red X for failure, yellow for pending). Show completionRate as progress indicator.

Use PageHeader, Card, Button, Spinner from existing components. Use Tailwind for all styling. Handle null/empty states for every section.

**Route registration:** Add `<Route path="trace-analysis" element={<TraceAnalysisPage />} />` in AppRouter.tsx under the test-monitor routes, following the pattern of existing routes.

**Tab registration:** In TestMonitor/index.tsx, add a tab entry `{ label: 'Trace Analysis', path: 'trace-analysis' }` to the tabs array. Add `export { default as TraceAnalysisPage } from './TraceAnalysisPage';` or equivalent re-export.
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit 2>&1 | head -20` -- compiles
2. `cd frontend && npm run build 2>&1 | tail -5` -- builds successfully
  </verify>
  <done>
TraceAnalysisPage renders with search bar, trace list, intent card, transcript, and tool sequence sections. Page is accessible at /test-monitor/trace-analysis and appears in TestMonitor tab navigation. Deep linking via ?sessionId=xxx works.
  </done>
</task>

</tasks>

<verification>
1. Frontend compiles without TypeScript errors
2. Frontend builds successfully (npm run build)
3. Navigate to /test-monitor/trace-analysis -- page renders with search bar
4. "Trace Analysis" tab appears in TestMonitor navigation
5. Enter a valid session ID -- data loads and displays in all sections
6. Navigate to /test-monitor/trace-analysis?sessionId=xxx -- auto-loads that session
</verification>

<success_criteria>
- Trace Analysis page exists and is accessible from navigation
- Session ID search loads and displays trace tree, transcript, intent classification, and tool sequence
- Deep linking via URL parameter works
- Null/empty states handled gracefully for all sections
</success_criteria>

<output>
After completion, create `.planning/phases/03-trace-analysis-ui/03-01-SUMMARY.md`
</output>
