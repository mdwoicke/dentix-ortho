{
  "nodes": [
    {
      "id": "azureChatOpenAI_0",
      "position": {
        "x": -768.8173286598604,
        "y": -236.06988292667916
      },
      "type": "customNode",
      "data": {
        "id": "azureChatOpenAI_0",
        "label": "Azure ChatOpenAI",
        "version": 7,
        "name": "azureChatOpenAI",
        "type": "AzureChatOpenAI",
        "baseClasses": [
          "AzureChatOpenAI",
          "ChatOpenAI",
          "BaseChatModel",
          "BaseLanguageModel",
          "Runnable"
        ],
        "category": "Chat Models",
        "description": "Wrapper around Azure OpenAI large language models that use the Chat endpoint",
        "inputParams": [
          {
            "label": "Connect Credential",
            "name": "credential",
            "type": "credential",
            "credentialNames": [
              "azureOpenAIApi"
            ],
            "optional": false,
            "id": "azureChatOpenAI_0-input-credential-credential",
            "display": true
          },
          {
            "label": "Model Name",
            "name": "modelName",
            "type": "asyncOptions",
            "loadMethod": "listModels",
            "id": "azureChatOpenAI_0-input-modelName-asyncOptions",
            "display": true
          },
          {
            "label": "Temperature",
            "name": "temperature",
            "type": "number",
            "step": 0.1,
            "default": 0.9,
            "optional": true,
            "id": "azureChatOpenAI_0-input-temperature-number",
            "display": true
          },
          {
            "label": "Max Tokens",
            "name": "maxTokens",
            "type": "number",
            "step": 1,
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-maxTokens-number",
            "display": true
          },
          {
            "label": "Streaming",
            "name": "streaming",
            "type": "boolean",
            "default": true,
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-streaming-boolean",
            "display": true
          },
          {
            "label": "Top Probability",
            "name": "topP",
            "type": "number",
            "step": 0.1,
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-topP-number",
            "display": true
          },
          {
            "label": "Frequency Penalty",
            "name": "frequencyPenalty",
            "type": "number",
            "step": 0.1,
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-frequencyPenalty-number",
            "display": true
          },
          {
            "label": "Presence Penalty",
            "name": "presencePenalty",
            "type": "number",
            "step": 0.1,
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-presencePenalty-number",
            "display": true
          },
          {
            "label": "Timeout",
            "name": "timeout",
            "type": "number",
            "step": 1,
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-timeout-number",
            "display": true
          },
          {
            "label": "BasePath",
            "name": "basepath",
            "type": "string",
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-basepath-string",
            "display": true
          },
          {
            "label": "BaseOptions",
            "name": "baseOptions",
            "type": "json",
            "optional": true,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-baseOptions-json",
            "display": true
          },
          {
            "label": "Allow Image Uploads",
            "name": "allowImageUploads",
            "type": "boolean",
            "description": "Allow image input. Refer to the <a href=\"https://docs.flowiseai.com/using-flowise/uploads#image\" target=\"_blank\">docs</a> for more details.",
            "default": false,
            "optional": true,
            "id": "azureChatOpenAI_0-input-allowImageUploads-boolean",
            "display": true
          },
          {
            "label": "Image Resolution",
            "description": "This parameter controls the resolution in which the model views the image.",
            "name": "imageResolution",
            "type": "options",
            "options": [
              {
                "label": "Low",
                "name": "low"
              },
              {
                "label": "High",
                "name": "high"
              },
              {
                "label": "Auto",
                "name": "auto"
              }
            ],
            "default": "low",
            "optional": false,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-imageResolution-options",
            "display": true
          },
          {
            "label": "Reasoning Effort",
            "description": "Constrains effort on reasoning for reasoning models. Only applicable for o1 and o3 models.",
            "name": "reasoningEffort",
            "type": "options",
            "options": [
              {
                "label": "Low",
                "name": "low"
              },
              {
                "label": "Medium",
                "name": "medium"
              },
              {
                "label": "High",
                "name": "high"
              }
            ],
            "default": "medium",
            "optional": false,
            "additionalParams": true,
            "id": "azureChatOpenAI_0-input-reasoningEffort-options",
            "display": true
          }
        ],
        "inputAnchors": [
          {
            "label": "Cache",
            "name": "cache",
            "type": "BaseCache",
            "optional": true,
            "id": "azureChatOpenAI_0-input-cache-BaseCache",
            "display": true
          }
        ],
        "inputs": {
          "cache": "",
          "modelName": "gpt-4.1",
          "temperature": "0",
          "maxTokens": "",
          "streaming": true,
          "topP": "",
          "frequencyPenalty": "",
          "presencePenalty": "",
          "timeout": "",
          "basepath": "",
          "baseOptions": "",
          "allowImageUploads": "",
          "imageResolution": "low",
          "reasoningEffort": "medium"
        },
        "outputAnchors": [
          {
            "id": "azureChatOpenAI_0-output-azureChatOpenAI-AzureChatOpenAI|ChatOpenAI|BaseChatModel|BaseLanguageModel|Runnable",
            "name": "azureChatOpenAI",
            "label": "AzureChatOpenAI",
            "description": "Wrapper around Azure OpenAI large language models that use the Chat endpoint",
            "type": "AzureChatOpenAI | ChatOpenAI | BaseChatModel | BaseLanguageModel | Runnable"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "width": 300,
      "height": 675,
      "selected": false,
      "positionAbsolute": {
        "x": -768.8173286598604,
        "y": -236.06988292667916
      },
      "dragging": false
    },
    {
      "id": "RedisBackedChatMemory_0",
      "position": {
        "x": -120.7493951996463,
        "y": 131.69201893430096
      },
      "type": "customNode",
      "data": {
        "id": "RedisBackedChatMemory_0",
        "label": "Redis-Backed Chat Memory",
        "version": 2,
        "name": "RedisBackedChatMemory",
        "type": "RedisBackedChatMemory",
        "baseClasses": [
          "RedisBackedChatMemory",
          "BaseChatMemory",
          "BaseMemory"
        ],
        "category": "Memory",
        "description": "Summarizes the conversation and stores the memory in Redis server",
        "inputParams": [
          {
            "label": "Connect Credential",
            "name": "credential",
            "type": "credential",
            "optional": true,
            "credentialNames": [
              "redisCacheApi",
              "redisCacheUrlApi"
            ],
            "id": "RedisBackedChatMemory_0-input-credential-credential",
            "display": true
          },
          {
            "label": "Session Id",
            "name": "sessionId",
            "type": "string",
            "description": "If not specified, a random id will be used. Learn <a target=\"_blank\" href=\"https://docs.flowiseai.com/memory/long-term-memory#ui-and-embedded-chat\">more</a>",
            "default": "",
            "additionalParams": true,
            "optional": true,
            "id": "RedisBackedChatMemory_0-input-sessionId-string",
            "display": true
          },
          {
            "label": "Session Timeouts",
            "name": "sessionTTL",
            "type": "number",
            "description": "Seconds till a session expires. If not specified, the session will never expire.",
            "additionalParams": true,
            "optional": true,
            "id": "RedisBackedChatMemory_0-input-sessionTTL-number",
            "display": true
          },
          {
            "label": "Memory Key",
            "name": "memoryKey",
            "type": "string",
            "default": "chat_history",
            "additionalParams": true,
            "id": "RedisBackedChatMemory_0-input-memoryKey-string",
            "display": true
          },
          {
            "label": "Window Size",
            "name": "windowSize",
            "type": "number",
            "description": "Window of size k to surface the last k back-and-forth to use as memory.",
            "additionalParams": true,
            "optional": true,
            "id": "RedisBackedChatMemory_0-input-windowSize-number",
            "display": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "sessionId": "",
          "sessionTTL": "",
          "memoryKey": "chat_history",
          "windowSize": ""
        },
        "outputAnchors": [
          {
            "id": "RedisBackedChatMemory_0-output-RedisBackedChatMemory-RedisBackedChatMemory|BaseChatMemory|BaseMemory",
            "name": "RedisBackedChatMemory",
            "label": "RedisBackedChatMemory",
            "description": "Summarizes the conversation and stores the memory in Redis server",
            "type": "RedisBackedChatMemory | BaseChatMemory | BaseMemory"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "width": 300,
      "height": 333,
      "selected": false,
      "dragging": false,
      "positionAbsolute": {
        "x": -120.7493951996463,
        "y": 131.69201893430096
      }
    },
    {
      "id": "currentDateTime_0",
      "position": {
        "x": -445.39070787946685,
        "y": 290.91268341092075
      },
      "type": "customNode",
      "data": {
        "id": "currentDateTime_0",
        "label": "CurrentDateTime",
        "version": 1,
        "name": "currentDateTime",
        "type": "CurrentDateTime",
        "baseClasses": [
          "CurrentDateTime",
          "Tool"
        ],
        "category": "Tools",
        "description": "Get todays day, date and time.",
        "inputParams": [],
        "inputAnchors": [],
        "inputs": {},
        "outputAnchors": [
          {
            "id": "currentDateTime_0-output-currentDateTime-CurrentDateTime|Tool",
            "name": "currentDateTime",
            "label": "CurrentDateTime",
            "description": "Get todays day, date and time.",
            "type": "CurrentDateTime | Tool"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "width": 300,
      "height": 149,
      "positionAbsolute": {
        "x": -445.39070787946685,
        "y": 290.91268341092075
      },
      "selected": false,
      "dragging": false
    },
    {
      "id": "toolAgent_0",
      "position": {
        "x": 209.26817487305743,
        "y": -6.148263885812071
      },
      "type": "customNode",
      "data": {
        "id": "toolAgent_0",
        "label": "Tool Agent",
        "version": 2,
        "name": "toolAgent",
        "type": "AgentExecutor",
        "baseClasses": [
          "AgentExecutor",
          "BaseChain",
          "Runnable"
        ],
        "category": "Agents",
        "description": "Agent that uses Function Calling to pick the tools and args to call",
        "inputParams": [
          {
            "label": "System Message",
            "name": "systemMessage",
            "type": "string",
            "default": "You are a helpful AI assistant.",
            "description": "If Chat Prompt Template is provided, this will be ignored",
            "rows": 4,
            "optional": true,
            "additionalParams": true,
            "id": "toolAgent_0-input-systemMessage-string",
            "display": true
          },
          {
            "label": "Max Iterations",
            "name": "maxIterations",
            "type": "number",
            "optional": true,
            "additionalParams": true,
            "id": "toolAgent_0-input-maxIterations-number",
            "display": true
          },
          {
            "label": "Enable Detailed Streaming",
            "name": "enableDetailedStreaming",
            "type": "boolean",
            "default": false,
            "description": "Stream detailed intermediate steps during agent execution",
            "optional": true,
            "additionalParams": true,
            "id": "toolAgent_0-input-enableDetailedStreaming-boolean",
            "display": true
          }
        ],
        "inputAnchors": [
          {
            "label": "Tools",
            "name": "tools",
            "type": "Tool",
            "list": true,
            "id": "toolAgent_0-input-tools-Tool",
            "display": true
          },
          {
            "label": "Memory",
            "name": "memory",
            "type": "BaseChatMemory",
            "id": "toolAgent_0-input-memory-BaseChatMemory",
            "display": true
          },
          {
            "label": "Tool Calling Chat Model",
            "name": "model",
            "type": "BaseChatModel",
            "description": "Only compatible with models that are capable of function calling: ChatOpenAI, ChatMistral, ChatAnthropic, ChatGoogleGenerativeAI, ChatVertexAI, GroqChat",
            "id": "toolAgent_0-input-model-BaseChatModel",
            "display": true
          },
          {
            "label": "Chat Prompt Template",
            "name": "chatPromptTemplate",
            "type": "ChatPromptTemplate",
            "description": "Override existing prompt with Chat Prompt Template. Human Message must includes {input} variable",
            "optional": true,
            "id": "toolAgent_0-input-chatPromptTemplate-ChatPromptTemplate",
            "display": true
          },
          {
            "label": "Input Moderation",
            "description": "Detect text that could generate harmful output and prevent it from being sent to the language model",
            "name": "inputModeration",
            "type": "Moderation",
            "optional": true,
            "list": true,
            "id": "toolAgent_0-input-inputModeration-Moderation",
            "display": true
          }
        ],
        "inputs": {
          "tools": [
            "{{currentDateTime_0.data.instance}}",
            "{{customTool_3.data.instance}}",
            "{{customTool_4.data.instance}}"
          ],
          "memory": "{{RedisBackedChatMemory_0.data.instance}}",
          "model": "{{azureChatOpenAI_0.data.instance}}",
          "chatPromptTemplate": "",
          "systemMessage": "# CDH ORTHO ALLEGHANY - Orthodontic Scheduling Agent (Cloud9 Integration)\n\nLanguage: English ONLY - This agent MUST ONLY speak English and NEVER speak Spanish or any other language.\nAGENT_NAME: Allie\nPERSONALITY: Friendly, Energetic, Engaging\nCONTEXT: All callers are parents or guardians scheduling orthodontic appointments for their children (patients aged 7-20).\n\n## LOCATION INFORMATION\n- Practice: CDH Ortho Alleghany\n- Location IDs: 77522, 333724\n- Address: 2301 East Allegheny Ave, Ste 300-M, Philadelphia, PA 19134\n- Phone: 267-529-0990\n- Hours: Every other Monday-Friday, 8:30am-4:30pm\n- Parking: Park in the parking lot across the building that reads Commonwealth Campus\n- Website: https://childrensdentalhealth.com/locations/philadelphia-allegheny/\n- Walk-ins: NOT allowed - appointments must be scheduled\n\n## CRITICAL MANDATORY REQUIREMENTS\n\n<Language_Rule>\nThis agent MUST ONLY speak English. NEVER speak Spanish or ANY other language.\n</Language_Rule>\n\n<Age_Validation_Rule>\nEvery time you receive a patient's date of birth, immediately calculate their age and validate eligibility.\nAGE LIMITS: Orthodontic patients must be 7-20 years old (inclusive).\nIf the patient is outside this age range, inform the caller and transfer to a live agent.\n</Age_Validation_Rule>\n\n<Null_Value_Rule>\nPAYLOAD values must use JSON null for missing data. NEVER use N/A, None, none, n/a, or empty strings.\n</Null_Value_Rule>\n\n<One_Question_Rule>\nNEVER ask two questions in the same response. Each turn should contain exactly ONE question or request for information.\n</One_Question_Rule>\n\n## VARIABLES DEFINITION\n\n<system_variables>\nc1mg_variable_caller_id_number - Caller phone number (Phone string)\nc1mg_uui - Unique call identifier (UUID string)\n</system_variables>\n\n<caller_variables>\ncaller_first_name - Caller first name (Alpha string, Required)\ncaller_last_name - Caller last name (Alpha string, Required)\nContact_Number - Confirmed phone number (Phone string, Required)\nEmail - Account email address (Email string, Optional)\ninsurance_provider - Insurance company name (Text string, Required)\ninsurance_status - accepted or not_accepted (String, Required)\ninsurance_group_id - Insurance group ID (Alphanumeric, Optional)\ninsurance_member_id - Insurance member ID (Alphanumeric, Optional)\nspecial_needs - Special conditions for children (Text string, Optional)\nprevious_ortho_treatment - Has child had ortho before (true/false, Required)\n</caller_variables>\n\n<location_variables>\nlocation_guid - Location GUID from Cloud9 (UUID, Required from API)\nlocation_name - Practice name (String, Required)\nprovider_guid - Provider GUID from slots (UUID, Required from API)\n</location_variables>\n\n## MULTI-CHILD DYNAMIC FIELD NAMING CONVENTION\n\nCRITICAL: When scheduling multiple children (siblings), ALL child-specific fields MUST use dynamic numbering with the pattern Child1_FieldName, Child2_FieldName, Child3_FieldName where the number = 1, 2, 3, etc.\n\n<child_fields>\nChild1_FirstName, Child2_FirstName, Child3_FirstName - Patient first name\nChild1_LastName, Child2_LastName, Child3_LastName - Patient last name\nChild1_DOB, Child2_DOB, Child3_DOB - Patient date of birth (YYYY-MM-DD)\nChild1_patientGUID, Child2_patientGUID - Patient GUID from create response\nChild1_appointmentGUID, Child2_appointmentGUID - Appointment GUID from book response\nChild1_schedule_view_guid, Child2_schedule_view_guid - Schedule view GUID\nChild1_schedule_column_guid, Child2_schedule_column_guid - Schedule column GUID\nChild1_Intent, Child2_Intent - Intent for this child (Schedule)\nChild1_Final_Disposition, Child2_Final_Disposition - Outcome for this child\nChild1_Appointment_Details, Child2_Appointment_Details - Date, Time details\nChild1_offered_slot, Child2_offered_slot - Object containing slot details\n</child_fields>\n\n<multi_child_rules>\n1. Do not assume count - Ask how many children if not stated\n2. Use caller terminology - twins, three kids, siblings, etc.\n3. Identify ALL children first - Collect name and DOB for each child BEFORE offering appointment times\n4. Use grouped_slots action - For multiple patients, use timeWindowMinutes: 30 for 1-2 children, 45 for 3+ children\n5. Book each child separately - Call chord_scheduling with action book_child once per child\n6. Store each appointment - Each child gets their own Child1_appointmentGUID, Child2_appointmentGUID, etc.\n</multi_child_rules>\n\n<special_needs_multiple>\nWhen multiple children have special needs, combine them in the special_needs field with child identifiers:\nExample: Child1 (Emma): wheelchair accessible; Child2 (Jake): sensory sensitivity\n</special_needs_multiple>\n\n## CONVERSATION FLOW\n\n<phase1_opening>\n1. Opening Greeting: Hi, my name is Allie, how may I help you today?\n2. Listen for caller intent\n3. Probing Questions (if intent unclear):\n   - Are you calling for general dentistry or orthodontics?\n   - Have any of your children been to any of our offices before?\n4. Intent Validation: ONLY handle Ortho New Patient Consults\n   - All other intents -> Transfer to live agent\n</phase1_opening>\n\n<phase2_verification>\n5. Caller Name Collection: Ask for first and last name in ONE question. Ask them to spell it, then confirm spelling.\n6. How Many Children: How many children are we scheduling for today?\n7. New Patient Verification:\n   - Confirm: Are you calling for a new patient consult?\n   - Ask: Have any of your children been to our offices before? (If YES -> Not new patient, inform caller)\n   - Ask: Have you/your children ever had Orthodontic treatment before? (Note in payload, continue regardless)\n</phase2_verification>\n\n<phase3_patient_info>\nFor each child (Child1, Child2, Child3, etc.):\n\n8. Patient Name: What is the first/next child first and last name? Have them spell it, confirm spelling.\n   - Store as Child1_FirstName and Child1_LastName (or Child2_, Child3_, etc.)\n9. Patient Date of Birth: What is the child date of birth?\n   - Store as Child1_DOB (format: YYYY-MM-DD)\n   - IMMEDIATELY validate age (7-20)\n\nAfter collecting info for ALL children, continue to account setup.\n</phase3_patient_info>\n\n<phase4_account>\n10. Insurance Information:\n    - Ask: What kind of insurance does the child have? (or do the children have for multiples)\n    - SILENT CHECK: Cross-reference with accepted insurance list\n    - If Accepted: Ask for Group number and Member ID (optional - remind to bring card if not available)\n    - If NOT Accepted: Inform caller insurance is not in-network; treatment would not be covered under in-network benefits. Proceed anyway.\n11. Special Needs: Do any of the patients have special needs or conditions we should be aware of for the appointment?\n12. Email Collection: Do you have an email address we can use for the account? (NOT mandatory - ask them to spell it, confirm)\n</phase4_account>\n\n<phase5_scheduling>\n13. Get Available Slots:\n    - For single child: Call chord_scheduling with action slots\n    - For multiple children: Call chord_scheduling with action grouped_slots, numberOfPatients, timeWindowMinutes 30 or 45\n14. Offer Times: Present morning/afternoon preference, then specific times one at a time\n    - Store offered slot in Child1_offered_slot for each child\n15. Book Appointments: For EACH child, call chord_scheduling with action book_child with:\n    - The child patientGUID (from create response)\n    - The specific slot data from Child1_offered_slot\n    - Store result in Child1_appointmentGUID\n</phase5_scheduling>\n\n<phase6_confirmation>\n16. Confirm Details: Read back ALL appointments:\n    - Single: I have scheduled the appointment for [patient_name] on [month] [day], [year] at [time].\n    - Multiple: I have scheduled [Child1 name] for [date] at [time], and [Child2 name] for [date] at [time].\n17. Offer Address: Would you like me to provide the address?\n    - If YES: 2301 East Allegheny Ave, Suite 300-M, Philadelphia, PA 19134. Park in the Commonwealth Campus lot across the building.\n18. Legal Guardian Notice: A Parent or legal guardian must be present at the first appointment. If the legal guardian is not the parent, physical court documentation must be with them at the time of the visit. New Patient Paperwork will be sent to the email on file. If the paperwork is not completed prior to the appointment, you must arrive 20-30 minutes early to complete it in office. Is there anything else I can help you with today?\n</phase6_confirmation>\n\n<phase7_closing>\n19. Closing: Have a wonderful day [caller_name]\n20. CRITICAL: Disconnect call exactly 4 seconds after final word - NO EXCEPTIONS\n</phase7_closing>\n\n## TOOLS REFERENCE\n\n<tool_chord_patient>\nUse for all patient and clinic operations.\n\nActions:\n- lookup: Find patient by phone number. Parameters: phoneNumber, filter\n- get: Get patient details by GUID. Parameters: patientGUID\n- create: Register new patient. Parameters: patientFirstName, patientLastName, birthdayDateTime, providerGUID, locationGUID, gender, phoneNumber, emailAddress\n- appointments: Get patient scheduled appointments. Parameters: patientGUID\n- clinic_info: Get clinic details (location name, address, hours). Parameters: locationGUID\n- edit_insurance: Update patient insurance. Parameters: patientGUID, insuranceProvider\n</tool_chord_patient>\n\n<tool_chord_scheduling>\nUse for appointment scheduling operations.\n\nActions:\n- slots: Get available appointment times. Parameters: startDate, endDate, scheduleViewGUIDs\n- grouped_slots: Get consecutive slots for multiple patients (siblings). Parameters: startDate, endDate, numberOfPatients, timeWindowMinutes (30 for 1-2 children, 45 for 3+)\n- book_child: Create appointment. Parameters: patientGUID, startTime, scheduleViewGUID, scheduleColumnGUID, appointmentTypeGUID, minutes, providerGUID, locationGUID\n- cancel: Cancel appointment. Parameters: appointmentGUID\n</tool_chord_scheduling>\n\n## ACCEPTED INSURANCE LIST (CDH Ortho Allegheny)\n\n<medicaid_plans>\nAetna Better Health, CHIP, AmeriHealth Caritas, Capital BC Chip, Gateway, Geisinger CHIP, Geisinger MA, Health Partners, Keystone First, Kidz Partners, PA Medicaid\n</medicaid_plans>\n\n## ERROR HANDLING\n\n<api_failures>\nIf a tool call fails, retry once. If still fails, transfer to live agent.\n</api_failures>\n\n<silence_response>\nI did not hear a response. If you still need assistance, please give us a call back, goodbye. -> Disconnect\n</silence_response>\n\n<age_out_of_range>\nInform caller: Unfortunately, orthodontic patients must be between 7 and 20 years old. I will connect you with a specialist. -> Transfer\n</age_out_of_range>\n\n<non_ortho_intent>\nTransfer to live agent for assistance.\n</non_ortho_intent>\n\n## OUTPUT FORMAT\n\nEvery response MUST use the ANSWER + PAYLOAD format. Include only fields with known values; omit fields until their values are obtained.\n\n<standard_payload>\nANSWER: your spoken response to the caller\n\nPAYLOAD:\n{{\n  \"TC\": \"turn count - start at 1, increment each turn\",\n  \"current_datetime\": \"from current_date_time tool on TC=2 - persist always\",\n  \"caller_intent\": \"schedule or other\",\n  \"caller_id_number\": \"from system variable - persist always\",\n  \"caller_first_name\": \"once obtained\",\n  \"caller_last_name\": \"once obtained\",\n  \"Contact_Number\": \"confirmed phone\",\n  \"Email\": \"if provided or null\",\n  \"insurance_provider\": \"insurance name\",\n  \"insurance_status\": \"accepted or not_accepted\",\n  \"insurance_group_id\": \"if provided or null\",\n  \"insurance_member_id\": \"if provided or null\",\n  \"special_needs\": \"notes for all children or null\",\n  \"previous_ortho_treatment\": \"true or false\",\n  \"location_guid\": \"from clinic_info\",\n  \"location_name\": \"CDH Ortho Alleghany\",\n  \"provider_guid\": \"from slots response\",\n  \"Child1_FirstName\": \"first child first name\",\n  \"Child1_LastName\": \"first child last name\",\n  \"Child1_DOB\": \"YYYY-MM-DD\",\n  \"Child1_patientGUID\": \"from create response\",\n  \"Child1_appointmentGUID\": \"from book response\",\n  \"Child1_schedule_view_guid\": \"from slot\",\n  \"Child1_schedule_column_guid\": \"from slot\",\n  \"Child1_offered_slot\": {{\n    \"date\": \"YYYY-MM-DD\",\n    \"time\": \"HH:MM AM/PM\",\n    \"day_of_week\": \"e.g., Wednesday\",\n    \"schedule_view_guid\": \"from slot\",\n    \"schedule_column_guid\": \"from slot\"\n  }},\n  \"Child2_FirstName\": \"second child - if applicable\",\n  \"Child2_LastName\": \"second child last name\",\n  \"Child2_DOB\": \"YYYY-MM-DD\",\n  \"Child2_patientGUID\": \"from create response\",\n  \"Child2_appointmentGUID\": \"from book response\",\n  \"Child2_schedule_view_guid\": \"from slot\",\n  \"Child2_schedule_column_guid\": \"from slot\",\n  \"Child2_offered_slot\": {{\n    \"date\": \"YYYY-MM-DD\",\n    \"time\": \"HH:MM AM/PM\",\n    \"day_of_week\": \"e.g., Wednesday\",\n    \"schedule_view_guid\": \"from slot\",\n    \"schedule_column_guid\": \"from slot\"\n  }}\n}}\n</standard_payload>\n\nFor additional children, continue the pattern: Child3_FirstName, Child3_LastName, Child3_DOB, Child3_patientGUID, Child3_appointmentGUID, Child3_offered_slot, etc.\n\n## INITIAL TURN\n\nOn first turn (TC=1):\n\n<initial_turn_example>\nANSWER: Hi, my name is Allie, how may I help you today?\n\nPAYLOAD:\n{{\n  \"setConfigPersist\": {{\n    \"isBargeIn\": false,\n    \"enableDTMF\": true\n  }},\n  \"TC\": \"1\"\n}}\n</initial_turn_example>\n\n## SECOND TURN\n\nOn TC=2, call current_date_time tool AND chord_patient with action clinic_info to get temporal and location context. Store and persist for entire call.\n\n## CALL TERMINATION\n\nWhen ending the call, include the complete Call_Summary with ALL child fields numbered appropriately:\n\n<termination_payload>\nANSWER: Have a wonderful day [caller_name]!\n\nPAYLOAD:\n{{\n  \"telephonyDisconnectCall\": {{\n    \"uuiPayload\": \"{{$vars.c1mg_variable_caller_id_number}}\",\n    \"phoneNumber\": \"{{$vars.c1mg_variable_caller_id_number}}\",\n    \"uuiTreatment\": \"override\"\n  }},\n  \"Call_Summary\": {{\n    \"Call_Location\": \"CDH Ortho Alleghany\",\n    \"location_name\": \"CDH Ortho Alleghany\",\n    \"location_guid\": \"from PAYLOAD or null\",\n    \"Caller_Identified\": \"True or False\",\n    \"Caller_Name\": \"full name or null\",\n    \"Contact_Number\": \"phone or null\",\n    \"Email\": \"email or null\",\n    \"special_needs\": \"notes for all children or null\",\n    \"insurance_provider\": \"insurance name or null\",\n    \"insurance_status\": \"accepted or not_accepted or null\",\n    \"previous_ortho_treatment\": \"true or false or null\",\n    \"Child1_FirstName\": \"name or null\",\n    \"Child1_LastName\": \"name or null\",\n    \"Child1_DOB\": \"YYYY-MM-DD or null\",\n    \"Child1_patientGUID\": \"GUID or null\",\n    \"Child1_appointmentGUID\": \"GUID or null\",\n    \"Child1_Intent\": \"Schedule\",\n    \"Child1_Final_Disposition\": \"Intent Complete or Transfer\",\n    \"Child1_Appointment_Details\": \"Date, Time or null\",\n    \"Child2_FirstName\": \"name or null - if applicable\",\n    \"Child2_LastName\": \"name or null\",\n    \"Child2_DOB\": \"YYYY-MM-DD or null\",\n    \"Child2_patientGUID\": \"GUID or null\",\n    \"Child2_appointmentGUID\": \"GUID or null\",\n    \"Child2_Intent\": \"Schedule\",\n    \"Child2_Final_Disposition\": \"Intent Complete or Transfer\",\n    \"Child2_Appointment_Details\": \"Date, Time or null\",\n    \"Call_Final_Disposition\": \"Intent Complete or Transfer or Abandoned\",\n    \"Language\": \"English\"\n  }},\n  \"TC\": \"final turn count\"\n}}\n</termination_payload>\n\nFor 3+ children, continue adding Child3_, Child4_, etc. with the same field structure.\n\n## PAYLOAD RULES\n\n<payload_rules>\n1. Add values immediately: When a tool returns data, IMMEDIATELY extract and add to PAYLOAD\n2. Never remove values: Once a field is in the PAYLOAD, it stays for all subsequent turns\n3. Use PAYLOAD values for tools: When calling chord_scheduling book_child, use patientGUID and slot data FROM YOUR PAYLOAD\n4. Increment TC every turn: Turn counter starts at 1 and increases by 1 each turn\n5. Omit until available: Do not include a field until you have its value, then always include it\n6. Use JSON null for missing data: ALWAYS use null - NEVER use none, N/A, or empty strings\n7. Number child fields sequentially: Child1_, Child2_, Child3_, etc. - never skip numbers\n</payload_rules>\n\nCRITICAL: Wait 4 seconds after final message, then disconnect. No exceptions.",
          "inputModeration": "",
          "maxIterations": "",
          "enableDetailedStreaming": ""
        },
        "outputAnchors": [
          {
            "id": "toolAgent_0-output-toolAgent-AgentExecutor|BaseChain|Runnable",
            "name": "toolAgent",
            "label": "AgentExecutor",
            "description": "Agent that uses Function Calling to pick the tools and args to call",
            "type": "AgentExecutor | BaseChain | Runnable"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "width": 300,
      "height": 490,
      "selected": false,
      "positionAbsolute": {
        "x": 209.26817487305743,
        "y": -6.148263885812071
      },
      "dragging": false
    },
    {
      "id": "customTool_3",
      "position": {
        "x": -443.4301051396301,
        "y": -240.573243564161
      },
      "type": "customNode",
      "data": {
        "id": "customTool_3",
        "label": "Custom Tool",
        "version": 3,
        "name": "customTool",
        "type": "CustomTool",
        "baseClasses": [
          "CustomTool",
          "Tool",
          "StructuredTool",
          "Runnable"
        ],
        "category": "Tools",
        "description": "Use custom tool you've created in Flowise within chatflow",
        "inputParams": [
          {
            "label": "Select Tool",
            "name": "selectedTool",
            "type": "asyncOptions",
            "loadMethod": "listTools",
            "id": "customTool_3-input-selectedTool-asyncOptions",
            "display": true
          },
          {
            "label": "Return Direct",
            "name": "returnDirect",
            "description": "Return the output of the tool directly to the user",
            "type": "boolean",
            "optional": true,
            "id": "customTool_3-input-returnDirect-boolean",
            "display": true
          },
          {
            "label": "Custom Tool Name",
            "name": "customToolName",
            "type": "string",
            "hidden": true,
            "id": "customTool_3-input-customToolName-string",
            "display": true
          },
          {
            "label": "Custom Tool Description",
            "name": "customToolDesc",
            "type": "string",
            "hidden": true,
            "id": "customTool_3-input-customToolDesc-string",
            "display": true
          },
          {
            "label": "Custom Tool Schema",
            "name": "customToolSchema",
            "type": "string",
            "hidden": true,
            "id": "customTool_3-input-customToolSchema-string",
            "display": true
          },
          {
            "label": "Custom Tool Func",
            "name": "customToolFunc",
            "type": "string",
            "hidden": true,
            "id": "customTool_3-input-customToolFunc-string",
            "display": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "selectedTool": "6b68fd1d-f185-4a07-9b97-e05af2ad7847",
          "returnDirect": "",
          "customToolName": "",
          "customToolDesc": "",
          "customToolSchema": "",
          "customToolFunc": ""
        },
        "outputAnchors": [
          {
            "id": "customTool_3-output-customTool-CustomTool|Tool|StructuredTool|Runnable",
            "name": "customTool",
            "label": "CustomTool",
            "description": "Use custom tool you've created in Flowise within chatflow",
            "type": "CustomTool | Tool | StructuredTool | Runnable"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "width": 300,
      "height": 377,
      "selected": false,
      "positionAbsolute": {
        "x": -443.4301051396301,
        "y": -240.573243564161
      },
      "dragging": false
    },
    {
      "id": "customTool_4",
      "position": {
        "x": -120.60618125843155,
        "y": -274.72410984652015
      },
      "type": "customNode",
      "data": {
        "id": "customTool_4",
        "label": "Custom Tool",
        "version": 3,
        "name": "customTool",
        "type": "CustomTool",
        "baseClasses": [
          "CustomTool",
          "Tool",
          "StructuredTool",
          "Runnable"
        ],
        "category": "Tools",
        "description": "Use custom tool you've created in Flowise within chatflow",
        "inputParams": [
          {
            "label": "Select Tool",
            "name": "selectedTool",
            "type": "asyncOptions",
            "loadMethod": "listTools",
            "id": "customTool_4-input-selectedTool-asyncOptions",
            "display": true
          },
          {
            "label": "Return Direct",
            "name": "returnDirect",
            "description": "Return the output of the tool directly to the user",
            "type": "boolean",
            "optional": true,
            "id": "customTool_4-input-returnDirect-boolean",
            "display": true
          },
          {
            "label": "Custom Tool Name",
            "name": "customToolName",
            "type": "string",
            "hidden": true,
            "id": "customTool_4-input-customToolName-string",
            "display": true
          },
          {
            "label": "Custom Tool Description",
            "name": "customToolDesc",
            "type": "string",
            "hidden": true,
            "id": "customTool_4-input-customToolDesc-string",
            "display": true
          },
          {
            "label": "Custom Tool Schema",
            "name": "customToolSchema",
            "type": "string",
            "hidden": true,
            "id": "customTool_4-input-customToolSchema-string",
            "display": true
          },
          {
            "label": "Custom Tool Func",
            "name": "customToolFunc",
            "type": "string",
            "hidden": true,
            "id": "customTool_4-input-customToolFunc-string",
            "display": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "selectedTool": "7111abd9-3ffd-40b7-9393-ae40d6687ace",
          "returnDirect": "",
          "customToolName": "",
          "customToolDesc": "",
          "customToolSchema": "",
          "customToolFunc": ""
        },
        "outputAnchors": [
          {
            "id": "customTool_4-output-customTool-CustomTool|Tool|StructuredTool|Runnable",
            "name": "customTool",
            "label": "CustomTool",
            "description": "Use custom tool you've created in Flowise within chatflow",
            "type": "CustomTool | Tool | StructuredTool | Runnable"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "width": 300,
      "height": 377,
      "selected": false,
      "positionAbsolute": {
        "x": -120.60618125843155,
        "y": -274.72410984652015
      },
      "dragging": false
    }
  ],
  "edges": [
    {
      "source": "azureChatOpenAI_0",
      "sourceHandle": "azureChatOpenAI_0-output-azureChatOpenAI-AzureChatOpenAI|ChatOpenAI|BaseChatModel|BaseLanguageModel|Runnable",
      "target": "toolAgent_0",
      "targetHandle": "toolAgent_0-input-model-BaseChatModel",
      "type": "buttonedge",
      "id": "azureChatOpenAI_0-azureChatOpenAI_0-output-azureChatOpenAI-AzureChatOpenAI|ChatOpenAI|BaseChatModel|BaseLanguageModel|Runnable-toolAgent_0-toolAgent_0-input-model-BaseChatModel"
    },
    {
      "source": "RedisBackedChatMemory_0",
      "sourceHandle": "RedisBackedChatMemory_0-output-RedisBackedChatMemory-RedisBackedChatMemory|BaseChatMemory|BaseMemory",
      "target": "toolAgent_0",
      "targetHandle": "toolAgent_0-input-memory-BaseChatMemory",
      "type": "buttonedge",
      "id": "RedisBackedChatMemory_0-RedisBackedChatMemory_0-output-RedisBackedChatMemory-RedisBackedChatMemory|BaseChatMemory|BaseMemory-toolAgent_0-toolAgent_0-input-memory-BaseChatMemory"
    },
    {
      "source": "currentDateTime_0",
      "sourceHandle": "currentDateTime_0-output-currentDateTime-CurrentDateTime|Tool",
      "target": "toolAgent_0",
      "targetHandle": "toolAgent_0-input-tools-Tool",
      "type": "buttonedge",
      "id": "currentDateTime_0-currentDateTime_0-output-currentDateTime-CurrentDateTime|Tool-toolAgent_0-toolAgent_0-input-tools-Tool"
    },
    {
      "source": "customTool_3",
      "sourceHandle": "customTool_3-output-customTool-CustomTool|Tool|StructuredTool|Runnable",
      "target": "toolAgent_0",
      "targetHandle": "toolAgent_0-input-tools-Tool",
      "type": "buttonedge",
      "id": "customTool_3-customTool_3-output-customTool-CustomTool|Tool|StructuredTool|Runnable-toolAgent_0-toolAgent_0-input-tools-Tool"
    },
    {
      "source": "customTool_4",
      "sourceHandle": "customTool_4-output-customTool-CustomTool|Tool|StructuredTool|Runnable",
      "target": "toolAgent_0",
      "targetHandle": "toolAgent_0-input-tools-Tool",
      "type": "buttonedge",
      "id": "customTool_4-customTool_4-output-customTool-CustomTool|Tool|StructuredTool|Runnable-toolAgent_0-toolAgent_0-input-tools-Tool"
    }
  ]
}
