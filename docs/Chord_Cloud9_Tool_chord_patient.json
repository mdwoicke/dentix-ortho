{
  "name": "chord_patient",
  "description": "Patient management and clinic operations for Cloud9 orthodontic practice. Use action 'lookup' to find patient by phone number, 'get' to retrieve patient by GUID, 'create' to register a new patient, 'appointments' to get patient's scheduled appointments, 'clinic_info' to get clinic details, or 'edit_insurance' to update patient insurance.",
  "color": "#1E90FF",
  "iconSrc": "",
  "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"action\": {\n      \"type\": \"string\",\n      \"enum\": [\"lookup\", \"get\", \"create\", \"appointments\", \"clinic_info\", \"edit_insurance\"],\n      \"description\": \"The operation to perform\"\n    },\n    \"phoneNumber\": {\n      \"type\": \"string\",\n      \"description\": \"Phone number for patient lookup\"\n    },\n    \"filter\": {\n      \"type\": \"string\",\n      \"description\": \"LastName, FirstName or Patient ID for lookup\"\n    },\n    \"patientGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Patient GUID for get/appointments/edit_insurance actions\"\n    },\n    \"patientFirstName\": {\n      \"type\": \"string\",\n      \"description\": \"Patient first name for create action\"\n    },\n    \"patientLastName\": {\n      \"type\": \"string\",\n      \"description\": \"Patient last name for create action\"\n    },\n    \"birthdayDateTime\": {\n      \"type\": \"string\",\n      \"description\": \"Patient date of birth in MM/DD/YYYY format\"\n    },\n    \"gender\": {\n      \"type\": \"string\",\n      \"enum\": [\"M\", \"F\"],\n      \"description\": \"Patient gender\"\n    },\n    \"emailAddress\": {\n      \"type\": \"string\",\n      \"description\": \"Email address for patient account\"\n    },\n    \"providerGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Provider GUID\"\n    },\n    \"locationGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Location GUID for the practice\"\n    },\n    \"insuranceProvider\": {\n      \"type\": \"string\",\n      \"description\": \"Insurance provider name\"\n    },\n    \"insuranceGroupId\": {\n      \"type\": \"string\",\n      \"description\": \"Insurance group ID\"\n    },\n    \"insuranceMemberId\": {\n      \"type\": \"string\",\n      \"description\": \"Insurance member ID\"\n    }\n  },\n  \"required\": [\"action\"]\n}",
  "func": "const fetch = require('node-fetch');\n\nconst NODE_RED_URL = process.env.NODE_RED_URL || 'http://localhost:1880';\n\nconst ENDPOINT_MAP = {\n    'lookup': '/chord/cloud9/getPatientByPhone',\n    'get': '/chord/cloud9/getPatient',\n    'create': '/chord/cloud9/createPatient',\n    'appointments': '/chord/cloud9/getPatientAppts',\n    'clinic_info': '/chord/cloud9/getClinicInfo',\n    'edit_insurance': '/chord/cloud9/editPatientInsurance'\n};\n\nasync function chordPatient(params) {\n    try {\n        const action = params.action;\n        const endpoint = ENDPOINT_MAP[action];\n        \n        if (!endpoint) {\n            throw new Error(`Unknown action: ${action}. Valid actions: lookup, get, create, appointments, clinic_info, edit_insurance`);\n        }\n        \n        const response = await fetch(`${NODE_RED_URL}${endpoint}`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(params)\n        });\n        \n        if (!response.ok) {\n            throw new Error(`API call failed with status ${response.status}`);\n        }\n        \n        const result = await response.json();\n        return JSON.stringify(result);\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            error: error.message\n        });\n    }\n}\n\nreturn chordPatient($action);"
}
