{
  "name": "chord_scheduling",
  "description": "Appointment scheduling operations for Cloud9 orthodontic practice. Use action 'slots' to get available appointment times, 'grouped_slots' for booking multiple patients together (e.g., siblings), 'book_child' to create an appointment, or 'cancel' to cancel an existing appointment.",
  "color": "#32CD32",
  "iconSrc": "",
  "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"action\": {\n      \"type\": \"string\",\n      \"enum\": [\"slots\", \"grouped_slots\", \"book_child\", \"cancel\"],\n      \"description\": \"The scheduling operation to perform\"\n    },\n    \"startDate\": {\n      \"type\": \"string\",\n      \"description\": \"Start date for slot search in MM/DD/YYYY format\"\n    },\n    \"endDate\": {\n      \"type\": \"string\",\n      \"description\": \"End date for slot search in MM/DD/YYYY format\"\n    },\n    \"scheduleViewGUIDs\": {\n      \"type\": \"string\",\n      \"description\": \"Comma-separated schedule view GUIDs to search\"\n    },\n    \"numberOfPatients\": {\n      \"type\": \"integer\",\n      \"description\": \"Number of patients for grouped_slots action\"\n    },\n    \"timeWindowMinutes\": {\n      \"type\": \"integer\",\n      \"description\": \"Time window in minutes for grouped_slots (30 for 1-2 children, 45 for 3+)\"\n    },\n    \"patientGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Patient GUID for book_child action\"\n    },\n    \"startTime\": {\n      \"type\": \"string\",\n      \"description\": \"Appointment start time in MM/DD/YYYY HH:MM AM format\"\n    },\n    \"scheduleViewGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Schedule view GUID for booking\"\n    },\n    \"scheduleColumnGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Schedule column GUID for booking\"\n    },\n    \"appointmentTypeGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Appointment type GUID for booking\"\n    },\n    \"minutes\": {\n      \"type\": \"integer\",\n      \"description\": \"Appointment duration in minutes\"\n    },\n    \"providerGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Provider GUID for booking\"\n    },\n    \"locationGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Location GUID for booking\"\n    },\n    \"appointmentGUID\": {\n      \"type\": \"string\",\n      \"description\": \"Appointment GUID for cancel action\"\n    }\n  },\n  \"required\": [\"action\"]\n}",
  "func": "const fetch = require('node-fetch');\n\nconst NODE_RED_URL = process.env.NODE_RED_URL || 'http://localhost:1880';\n\nconst ENDPOINT_MAP = {\n    'slots': '/chord/cloud9/getApptSlots',\n    'grouped_slots': '/chord/cloud9/getGroupedApptSlots',\n    'book_child': '/chord/cloud9/createChildAppt',\n    'cancel': '/chord/cloud9/cancelAppt'\n};\n\nasync function chordScheduling(params) {\n    try {\n        const action = params.action;\n        const endpoint = ENDPOINT_MAP[action];\n        \n        if (!endpoint) {\n            throw new Error(`Unknown action: ${action}. Valid actions: slots, grouped_slots, book_child, cancel`);\n        }\n        \n        const response = await fetch(`${NODE_RED_URL}${endpoint}`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(params)\n        });\n        \n        if (!response.ok) {\n            throw new Error(`API call failed with status ${response.status}`);\n        }\n        \n        const result = await response.json();\n        return JSON.stringify(result);\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            error: error.message\n        });\n    }\n}\n\nreturn chordScheduling($action);"
}
